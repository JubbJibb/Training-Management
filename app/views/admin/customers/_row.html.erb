<%
  customer = local_assigns[:customer]
  segment = local_assigns[:segment].to_s.presence || "all"
  sort = local_assigns[:sort].to_s.presence
  direction = local_assigns[:direction].to_s.downcase == "asc" ? "asc" : "desc"
  base_params = local_assigns[:base_params] || {}
%>
<tr id="<%= dom_id(customer, :row) %>" class="tc-saas-tr">
  <td class="tc-saas-td tc-saas-td--customer">
    <div class="tc-saas-class-cell">
      <%= link_to admin_customer_path(customer), class: "tc-saas-class-link" do %>
        <%= customer.company_name %>
      <% end %>
      <% if customer.email.present? %>
        <span class="tc-saas-class-meta"><%= customer.email %></span>
      <% end %>
    </div>
  </td>
  <td class="tc-saas-td tc-saas-td--center">
    <span class="badge <%= customer.participant_type == 'Corp' ? 'badge-type-corp' : 'badge-type-indi' %> badge-modern"><%= customer.participant_type.presence || "—" %></span>
  </td>
  <td class="tc-saas-td tc-saas-td--center"><%= customer.respond_to?(:times_attended) ? customer.times_attended.to_i : 0 %></td>
  <td class="tc-saas-td truncate">
    <% la = customer.respond_to?(:last_attended_at) ? customer.last_attended_at : nil %>
    <%= la.present? ? (la.is_a?(Date) ? la.strftime("%d/%m/%y") : (la.respond_to?(:strftime) ? la.strftime("%d/%m/%y") : la.to_s)) : "—" %>
  </td>
  <td class="tc-saas-td tc-saas-td--num"><%= number_to_thb(customer.respond_to?(:total_spent_net_raw) ? customer.total_spent_net_raw.to_f : 0) %></td>
  <td class="tc-saas-td tc-saas-td--num"><%= number_to_thb(customer.respond_to?(:outstanding_raw) ? customer.outstanding_raw.to_f : 0) %></td>
  <td class="tc-saas-td tc-saas-td--center"><%= customer.respond_to?(:seats_total_raw) ? customer.seats_total_raw.to_i : 0 %></td>
  <td class="tc-saas-td tc-saas-td--center"><%= render "admin/customers/billing_tax_icons", customer: customer, segment: segment, sort: sort, direction: direction, base_params: base_params %></td>
  <td class="tc-saas-td tc-saas-td--actions">
    <div class="tc-saas-actions">
      <%= link_to register_for_class_admin_customer_path(customer), class: "tc-saas-actions-btn", title: "สมัครเรียน", aria: { label: "สมัครเรียน" } do %><i class="bi bi-person-plus" aria-hidden="true"></i><% end %>
      <%= link_to edit_admin_customer_path(customer), class: "tc-saas-actions-btn", title: "Edit", aria: { label: "Edit" } do %><i class="bi bi-pencil" aria-hidden="true"></i><% end %>
    </div>
  </td>
</tr>
