<%
  training_class = local_assigns[:training_class] || @training_class
  export_path = export_documents_admin_training_class_attendees_path(training_class)
  all_attendee_ids = training_class.attendees.pluck(:id)
  accounting_columns = %w[name email company name_thai tax_id address class_name unit_price discount vat final_price document_status quotation_no invoice_no receipt_no payment_slip amount payment_date]
%>
<div class="modal fade" id="exportExcelModal" tabindex="-1" aria-labelledby="exportExcelModalLabel" aria-hidden="true" data-export-modal data-all-ids="<%= all_attendee_ids.join(',') %>">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content modal-content--ds">
      <%= form_with url: export_path, method: :get, local: true, id: "exportExcelForm", target: "_blank", data: { export_excel_form: true } do |f| %>
        <div class="modal-header">
          <h2 class="modal-title" id="exportExcelModalLabel">Export to Excel (Accounting)</h2>
          <button type="button" class="modal-close" data-bs-dismiss="modal" aria-label="Close"><i class="bi bi-x-lg" aria-hidden="true"></i></button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <fieldset class="form-group__fieldset" aria-describedby="scope-hint">
              <legend class="form-group__legend">Scope</legend>
              <label class="form-group__radio">
                <input type="radio" name="scope" value="selected" id="exportScopeSelected" data-export-scope="selected" checked>
                <span>Selected rows</span>
              </label>
              <label class="form-group__radio">
                <input type="radio" name="scope" value="all" id="exportScopeAll" data-export-scope="all">
                <span>All results in current filter</span>
              </label>
              <p class="form-group__hint" id="scope-hint">When any row is selected, "Selected rows" is used by default.</p>
            </fieldset>
          </div>
          <div class="form-group" id="exportScopeValidation" hidden role="alert">
            <p class="form-group__error">Please select at least one row, or choose "All results in current filter".</p>
          </div>
          <div class="form-group">
            <fieldset class="form-group__fieldset">
              <legend class="form-group__legend">Template</legend>
              <label class="form-group__radio">
                <input type="radio" name="template" value="summary" id="exportTemplateSummary" data-export-template="summary" checked>
                <span>Accounting Summary (Recommended)</span>
              </label>
              <label class="form-group__radio">
                <input type="radio" name="template" value="full" id="exportTemplateFull" data-export-template="full">
                <span>Full Detail</span>
              </label>
              <p class="form-group__hint">Full Detail includes all available columns.</p>
            </fieldset>
          </div>
          <div id="exportExcelAttendeeIds" data-export-ids-container></div>
          <div data-export-columns-summary>
            <% accounting_columns.each do |col| %>
              <input type="hidden" name="columns[]" value="<%= col %>" data-export-column-summary>
            <% end %>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn--secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn--primary" id="exportExcelSubmit" aria-label="Export">Export</button>
        </div>
      <% end %>
    </div>
  </div>
</div>
