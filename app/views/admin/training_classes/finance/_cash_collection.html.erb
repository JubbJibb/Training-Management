<% ar = dashboard[:ar_aging] %>
<% ts = dashboard[:revenue_timeseries] %>
<div class="cfo-two-col cfo-section">
  <div class="cfo-two-col__block">
    <h2 class="cfo-section-title">Cash &amp; Collection</h2>
    <h3 class="cfo-section-title" style="font-size: 0.875rem; margin-top: 16px;">AR Aging</h3>
    <% buckets = ar[:buckets] %>
    <% if buckets.any? { |b| (b[:amount].to_f + b[:count].to_i) > 0 } %>
      <ul style="list-style: none; padding: 0; margin: 0 0 16px;">
        <% buckets.each do |b| %>
          <li style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid rgba(41,41,41,0.06); font-size: 0.875rem;">
            <span><%= b[:range] %></span>
            <span><%= number_to_thb(b[:amount]) %> Â· <%= b[:count] %> </span>
          </li>
        <% end %>
      </ul>
      <p style="font-size: 0.8125rem; margin: 0 0 8px;"><strong>Overdue:</strong> <%= ar[:overdue_count] %> items, <%= number_to_thb(ar[:overdue_amount]) %></p>
      <p style="font-size: 0.8125rem; margin: 0; color: #13139c;"><strong>Next 7 days due:</strong> <%= number_to_thb(ar[:next_7_days_due]) %></p>
    <% else %>
      <p class="cfo-empty">No AR aging data in this view.</p>
    <% end %>
  </div>
  <div class="cfo-two-col__block">
    <h3 class="cfo-section-title">Revenue vs Cash</h3>
    <div class="cfo-chart-placeholder" aria-hidden="true">
      <svg viewBox="0 0 400 180" xmlns="http://www.w3.org/2000/svg">
        <line x1="40" y1="20" x2="40" y2="160" stroke="rgba(41,41,41,0.2)" stroke-width="1"/>
        <line x1="40" y1="160" x2="380" y2="160" stroke="rgba(41,41,41,0.2)" stroke-width="1"/>
        <text x="200" y="175" text-anchor="middle" font-size="10" fill="rgba(41,41,41,0.5)">Period</text>
        <text x="15" y="90" text-anchor="middle" font-size="10" fill="rgba(41,41,41,0.5)" transform="rotate(-90 15 90)">Amount</text>
        <polyline points="60,140 120,120 180,100 240,80 300,60 360,50" fill="none" stroke="#13139c" stroke-width="2" opacity="0.8"/>
        <polyline points="60,130 120,115 180,95 240,85 300,70 360,55" fill="none" stroke="#059669" stroke-width="2" opacity="0.8"/>
        <text x="360" y="45" font-size="9" fill="#13139c">Net</text>
        <text x="360" y="58" font-size="9" fill="#059669">Cash</text>
      </svg>
    </div>
    <% if ts.present? %>
      <table class="table table-sm" style="font-size: 0.8125rem;">
        <thead>
          <tr>
            <th>Period</th>
            <th class="text-end">Net Revenue</th>
            <th class="text-end">Cash Received</th>
          </tr>
        </thead>
        <tbody>
          <% ts.each do |r| %>
            <tr>
              <td><%= r[:label] %></td>
              <td class="text-end"><%= number_to_thb(r[:net_revenue]) %></td>
              <td class="text-end"><%= number_to_thb(r[:cash_received]) %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    <% else %>
      <p class="cfo-empty">No time series data.</p>
    <% end %>
  </div>
</div>
