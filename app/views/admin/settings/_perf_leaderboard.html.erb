<%
  rows = @perf_leaderboard || []
  medals = ["ðŸ¥‡", "ðŸ¥ˆ", "ðŸ¥‰"]
%>
<section class="perf-leaderboard" aria-labelledby="perf-leaderboard-title">
  <h3 id="perf-leaderboard-title" class="perf-section-title">Leaderboard</h3>
  <% if rows.any? %>
    <%= odt_table(extra_class: "perf-leaderboard__wrap", sticky_header: true) do %>
      <thead>
        <tr>
          <th scope="col" class="odt-th col-xs text-center"><span class="th-inner">#</span></th>
          <th scope="col" class="odt-th col-lg"><span class="th-inner">Promotion</span></th>
          <th scope="col" class="odt-th col-sm"><span class="th-inner">Type</span></th>
          <th scope="col" class="odt-th col-sm num"><span class="th-inner">Revenue</span></th>
          <th scope="col" class="odt-th col-xs num"><span class="th-inner">Seats</span></th>
          <th scope="col" class="odt-th col-xs num"><span class="th-inner">Margin %</span></th>
          <th scope="col" class="odt-th col-sm num"><span class="th-inner">Discount</span></th>
          <th scope="col" class="odt-th col-sm"><span class="th-inner">Impact</span></th>
          <th scope="col" class="odt-th cell-actions actions"><span class="visually-hidden">Actions</span></th>
        </tr>
      </thead>
      <tbody>
        <% rows.each_with_index do |r, i| %>
          <tr class="perf-leaderboard__row">
            <td class="col-xs text-center"><%= medals[i] || (i + 1) %></td>
            <td class="col-lg truncate"><span class="cell-stack__primary"><%= r[:name] %></span></td>
            <td class="col-sm"><%= odt_badge(r[:type_label], variant: :neutral, size: :sm) %></td>
            <td class="col-sm odt-table-numeric num"><%= number_to_thb(r[:revenue].to_f) %></td>
            <td class="col-xs odt-table-numeric num"><%= r[:seats] %></td>
            <td class="col-xs odt-table-numeric num perf-leaderboard__margin"><%= r[:margin_pct] %>%</td>
            <td class="col-sm odt-table-numeric num perf-leaderboard__discount"><%= number_to_thb(r[:discount_cost].to_f) %></td>
            <td class="col-sm truncate"><span class="perf-impact perf-impact--<%= r[:impact_tag].to_s.parameterize %>"><%= r[:impact_tag] %></span></td>
            <td class="cell-actions actions">
              <%= link_to "View", promotion_drilldown_admin_settings_path(r[:id], params.permit(:period, :date_from, :date_to, :course_id, :segment, :channel, :payment_status).to_h), data: { turbo_frame: "promotion_drawer" }, class: "perf-leaderboard__link", aria: { label: "View #{r[:name]} details" } %>
            </td>
          </tr>
        <% end %>
      </tbody>
    <% end %>
  <% else %>
    <%= render "shared/empty_state", message: "No promotion usage in this period.", icon: "trophy" %>
  <% end %>
</section>
