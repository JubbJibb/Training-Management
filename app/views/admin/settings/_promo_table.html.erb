<div class="promo-mgmt-section">
  <%= render "components/odt/section_header", title: "Active Promotions", subtitle: "Edit, duplicate or deactivate" %>

  <div class="promo-mgmt-section__body">
    <% if @promotions.any? %>
      <%= odt_table(extra_class: "promo-mgmt-table-wrap promo-mgmt-table promo-mgmt-table--zebra") do %>
        <thead>
          <tr>
            <th class="odt-th col-lg"><span class="th-inner">Name</span></th>
            <th class="odt-th col-sm"><span class="th-inner">Type</span></th>
            <th class="odt-th col-lg"><span class="th-inner">Discount logic</span></th>
            <th class="odt-th col-xs num"><span class="th-inner">Usage</span></th>
            <th class="odt-th col-sm num"><span class="th-inner">Revenue impact</span></th>
            <th class="odt-th col-sm num"><span class="th-inner">Discount cost</span></th>
            <th class="odt-th col-xs"><span class="th-inner">Segment</span></th>
            <th class="odt-th col-xs"><span class="th-inner">Status</span></th>
            <th class="odt-th cell-actions actions"><span class="th-inner">Actions</span></th>
          </tr>
        </thead>
        <tbody>
          <% @promotions.each do |p| %>
            <% perf = (@promo_performance || []).find { |r| r[:id] == p.id } %>
            <% usage = (@promo_usage || {}).fetch(p.id, 0) %>
            <tr class="promo-mgmt-table__row">
              <td class="col-lg cell-stack"><span class="cell-stack__primary"><%= p.name %></span></td>
              <td class="col-sm truncate"><%= p.discount_type.humanize %></td>
              <td class="col-lg truncate"><%= p.discount_description %></td>
              <td class="col-xs odt-table-numeric num"><%= usage %></td>
              <td class="col-sm odt-table-numeric num"><%= perf ? number_to_thb(perf[:revenue_generated].to_f) : "—" %></td>
              <td class="col-sm odt-table-numeric num"><%= perf ? number_to_thb(perf[:total_discount_cost].to_f) : "—" %></td>
              <td class="col-xs">All</td>
              <td class="col-xs"><%= p.active? ? odt_badge("Active", variant: :success, size: :sm) : odt_badge("Inactive", variant: :neutral, size: :sm) %></td>
              <td class="cell-actions actions">
                <%= link_to edit_admin_setting_path(p), class: "promo-mgmt-action-btn", title: "Edit" do %><i class="bi bi-pencil" aria-hidden="true"></i><% end %>
                <%= link_to new_admin_setting_path(clone_from: p.id), class: "promo-mgmt-action-btn", title: "Duplicate" do %><i class="bi bi-copy" aria-hidden="true"></i><% end %>
                <%= link_to admin_setting_path(p), data: { turbo_method: :delete, turbo_confirm: "Delete this promotion?" }, class: "promo-mgmt-action-btn promo-mgmt-action-btn--danger", title: "Delete" do %><i class="bi bi-trash" aria-hidden="true"></i><% end %>
              </td>
            </tr>
          <% end %>
        </tbody>
      <% end %>
    <% else %>
      <%= render "shared/empty_state", message: "No promotions yet. Create your first promotion to get started.", icon: "tag" %>
      <p class="mt-3"><%= link_to "New Promotion", new_admin_setting_path, class: "odt-btn odt-btn--primary odt-btn--sm" %></p>
    <% end %>
  </div>
</div>
