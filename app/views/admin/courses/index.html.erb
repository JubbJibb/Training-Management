<% content_for :title, "Course Management" %>

<%= render "components/odt/page_header", title: "Course Management", subtitle: "Courses synced from training.odds.team", icon: "journal-bookmark" do %>
  <%= button_to sync_admin_courses_path, method: :post, class: "odt-btn odt-btn--primary odt-btn--md", data: { turbo_confirm: "ดึงรายการคอร์สล่าสุดจาก https://training.odds.team/courses ใช่หรือไม่?" } do %>
    <i class="bi bi-cloud-download odt-btn__icon odt-btn__icon--left" aria-hidden="true"></i>
    <span class="odt-btn__label">Sync from ODT</span>
  <% end %>
<% end %>

<% if @last_synced %>
  <p class="courses-index-synced">
    <i class="bi bi-clock" aria-hidden="true"></i> Last synced: <%= l(@last_synced, format: :long) %>
  </p>
<% end %>

<div class="courses-index-page">
  <div class="courses-index-content">
    <% if @courses.any? %>
      <div class="courses-list">
        <div class="courses-list__header" role="row">
          <span class="courses-list__header-cell courses-list__header-cell--main">Course</span>
          <span class="courses-list__header-cell courses-list__header-cell--actions">Actions</span>
        </div>
        <% @courses.each do |course| %>
          <div class="courses-list__item" role="article">
            <div class="courses-list__main">
              <h3 class="courses-list__title">
                <%= link_to course.title, admin_course_path(course), class: "courses-list__title-link" %>
              </h3>
              <p class="courses-list__description"><%= course.description.presence || "—" %></p>
              <div class="courses-list__badges">
                <% if course.capacity.present? %>
                  <span class="courses-list__badge" title="Capacity"><i class="bi bi-people" aria-hidden="true"></i> <%= course.capacity %></span>
                <% end %>
                <% if course.duration_text.present? %>
                  <span class="courses-list__badge" title="Duration"><i class="bi bi-clock" aria-hidden="true"></i> <%= course.duration_text %></span>
                <% end %>
                <% if course.category.present? %>
                  <span class="courses-list__badge" title="Category"><i class="bi bi-tag" aria-hidden="true"></i> <%= course.category %></span>
                <% end %>
                <% if course.capacity.blank? && course.duration_text.blank? && course.category.blank? %>
                  <span class="courses-list__badge courses-list__badge--muted">—</span>
                <% end %>
              </div>
            </div>
            <div class="courses-list__actions">
              <% if course.source_url.present? %>
                <%= link_to course.source_url, target: "_blank", rel: "noopener", class: "courses-list__btn courses-list__btn--icon", title: "Open on ODT", aria: { label: "Open on ODT" } do %><i class="bi bi-box-arrow-up-right" aria-hidden="true"></i><% end %>
              <% end %>
              <%= link_to edit_admin_course_path(course), class: "courses-list__btn courses-list__btn--icon", title: "Edit", aria: { label: "Edit" } do %><i class="bi bi-pencil" aria-hidden="true"></i><% end %>
              <%= link_to new_admin_training_class_path(course_id: course.id), class: "courses-list__btn courses-list__btn--primary", title: "Create Class", aria: { label: "Create Class" } do %><i class="bi bi-plus-circle" aria-hidden="true"></i> Class<% end %>
            </div>
          </div>
        <% end %>
      </div>
    <% else %>
      <div class="courses-index-empty">
        <p class="courses-index-empty__text">
          <i class="bi bi-info-circle" aria-hidden="true"></i>
          ยังไม่มีรายการคอร์ส กด <strong>Sync from ODT</strong> เพื่อดึงรายการจาก
          <a href="https://training.odds.team/courses" target="_blank" rel="noopener">training.odds.team/courses</a>
        </p>
      </div>
    <% end %>
  </div>
</div>
