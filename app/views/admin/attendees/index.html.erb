<% content_for :title, "Attendees - #{@training_class.title}" %>

<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <%= link_to admin_training_class_path(@training_class), class: "btn btn-outline-secondary mb-2" do %>
      <i class="bi bi-arrow-left"></i> Back to Class
    <% end %>
    <h1><i class="bi bi-people"></i> Attendees - <%= @training_class.title %></h1>
  </div>
  <div>
    <%= link_to new_admin_training_class_attendee_path(@training_class), class: "btn btn-primary" do %>
      <i class="bi bi-plus-circle"></i> Add Attendee
    <% end %>
    <%= link_to export_admin_training_class_attendees_path(@training_class, format: :csv), class: "btn btn-success" do %>
      <i class="bi bi-download"></i> Export CSV
    <% end %>
  </div>
</div>

<div class="card">
  <div class="card-body">
    <% if @attendees.any? %>
      <div class="table-responsive">
        <table class="table table-hover">
          <thead>
            <tr>
              <th>Name</th>
              <th>Email</th>
              <th>Phone</th>
              <th>Company</th>
              <th>Payment Status</th>
              <th>Slip</th>
              <th>Notes</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <% @attendees.each do |attendee| %>
              <tr>
                <td><strong><%= attendee.name %></strong></td>
                <td><%= attendee.email %></td>
                <td><%= attendee.phone || "—" %></td>
                <td><%= attendee.company || "—" %></td>
                <td>
                  <span class="badge <%= attendee.payment_status == "Paid" ? "bg-success" : "bg-warning" %>">
                    <%= attendee.payment_status || "Pending" %>
                  </span>
                </td>
                <td class="text-center">
                  <% if attendee.payment_slip.attached? %>
                    <%= link_to rails_blob_path(attendee.payment_slip, disposition: "inline"), 
                        target: "_blank", class: "btn btn-sm btn-outline-info", title: "View Slip" do %>
                      <i class="bi bi-file-earmark-image"></i>
                    <% end %>
                  <% else %>
                    <span class="text-muted">—</span>
                  <% end %>
                </td>
                <td><%= attendee.notes.present? ? truncate(attendee.notes, length: 50) : "—" %></td>
                <td>
                  <%= link_to edit_admin_training_class_attendee_path(@training_class, attendee), 
                      class: "btn btn-sm btn-outline-secondary", title: "Edit" do %>
                    <i class="bi bi-pencil"></i>
                  <% end %>
                  <%= link_to admin_training_class_attendee_path(@training_class, attendee), 
                      data: { turbo_method: :delete, confirm: "Remove this attendee?" },
                      class: "btn btn-sm btn-outline-danger", title: "Remove" do %>
                    <i class="bi bi-trash"></i>
                  <% end %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
      <div class="mt-3">
        <p class="text-muted">
          <strong>Total:</strong> <%= @attendees.count %> attendee<%= "s" if @attendees.count != 1 %>
          <% if @training_class.max_attendees %>
            (Max: <%= @training_class.max_attendees %>)
          <% end %>
        </p>
      </div>
    <% else %>
      <div class="text-center py-5">
        <i class="bi bi-people display-1 text-muted"></i>
        <p class="text-muted mt-3">No attendees registered yet.</p>
        <%= link_to "Add First Attendee", new_admin_training_class_attendee_path(@training_class), class: "btn btn-primary" %>
      </div>
    <% end %>
  </div>
</div>
