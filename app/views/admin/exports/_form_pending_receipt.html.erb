<%
  export_job = export_job
  # Pending Receipt: auto-filter paid + no receipt. Optional class and date range.
  classes = @filter_training_classes || TrainingClass.order(date: :desc).limit(80)
%>
<%= form_with model: export_job, url: admin_exports_path, method: :post, local: false, class: "export-form", data: { turbo_frame: "_top" } do |f| %>
  <%= f.hidden_field :export_type, value: "pending_receipt" %>
  <%= f.hidden_field :format, value: "xlsx" %>

  <p class="export-form__hint mb-3">Export attendees who have <strong>Paid</strong> but <strong>no Receipt</strong> issued. Optional filters below.</p>

  <div class="export-form__row">
    <label class="export-form__label">Start date</label>
    <%= date_field_tag "export_job[filters][start_date]", export_job.filters_hash["start_date"].presence || Date.current.beginning_of_month, class: "export-form__input" %>
  </div>
  <div class="export-form__row">
    <label class="export-form__label">End date</label>
    <%= date_field_tag "export_job[filters][end_date]", export_job.filters_hash["end_date"].presence || Date.current.end_of_month, class: "export-form__input" %>
  </div>
  <div class="export-form__row">
    <label class="export-form__label">Classes (optional)</label>
    <select name="export_job[filters][class_ids][]" id="export_pending_receipt_class_ids" class="export-form__select" multiple size="4" style="min-height: 100px;">
      <% classes.each do |tc| %>
        <option value="<%= tc.id %>"><%= tc.title %> (<%= tc.date.strftime("%d/%m/%Y") %>)</option>
      <% end %>
    </select>
    <small class="export-form__help">Hold Ctrl/Cmd to select multiple. Leave empty for all classes in date range.</small>
  </div>

  <div class="export-form__actions">
    <%= link_to "Cancel", admin_exports_path, class: "odt-btn odt-btn--secondary odt-btn--sm", data: { turbo_frame: "_top" } %>
    <%= f.submit "Download", class: "odt-btn odt-btn--primary odt-btn--sm" %>
  </div>
<% end %>
