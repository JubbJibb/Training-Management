<% content_for :title, "Exports" %>

<%= render "components/odt/page_header", title: "Exports", subtitle: "Generate and download reports", icon: "download" %>

<%# Section: Financial Reports %>
<div class="export-section">
  <h3 class="export-section__title"><i class="bi bi-graph-up me-2" aria-hidden="true"></i>Financial Reports</h3>
  <div class="export-cards">
    <%= link_to new_admin_export_path(export_type: "overall_revenue_summary"), class: "export-card", data: { turbo_frame: "export_modal" } do %>
      <span class="export-card__icon"><i class="bi bi-pie-chart" aria-hidden="true"></i></span>
      <span class="export-card__label">Overall Revenue Summary</span>
      <span class="export-card__desc">Combined revenue with breakdown (by month, class, or payment status)</span>
    <% end %>
    <%= link_to new_admin_export_path(export_type: "class_financial_report"), class: "export-card", data: { turbo_frame: "export_modal" } do %>
      <span class="export-card__icon"><i class="bi bi-journal-bookmark" aria-hidden="true"></i></span>
      <span class="export-card__label">Class-Specific Financial Report</span>
      <span class="export-card__desc">Revenue, discounts, VAT, net per class 路 multi-select classes</span>
    <% end %>
    <%= link_to new_admin_export_path(export_type: "financial_report", file_format: "pdf"), class: "export-card", data: { turbo_frame: "export_modal" } do %>
      <span class="export-card__icon"><i class="bi bi-file-pdf" aria-hidden="true"></i></span>
      <span class="export-card__label">Financial Report (PDF)</span>
      <span class="export-card__desc">Full financial report with optional sections</span>
    <% end %>
    <%= link_to new_admin_export_path(export_type: "financial_data"), class: "export-card", data: { turbo_frame: "export_modal" } do %>
      <span class="export-card__icon"><i class="bi bi-table" aria-hidden="true"></i></span>
      <span class="export-card__label">Financial Data (Excel)</span>
      <span class="export-card__desc">Raw financial data export</span>
    <% end %>
  </div>
</div>

<%# Section: Attendee Data & Documents %>
<div class="export-section">
  <h3 class="export-section__title"><i class="bi bi-people me-2" aria-hidden="true"></i>Attendee Data & Documents</h3>
  <div class="export-cards">
    <%= link_to new_admin_export_path(export_type: "pending_receipt"), class: "export-card export-card--highlight", data: { turbo_frame: "export_modal" } do %>
      <span class="export-card__icon"><i class="bi bi-receipt-cutoff" aria-hidden="true"></i></span>
      <span class="export-card__label">Pending Receipt Generation</span>
      <span class="export-card__desc">Paid but no receipt 路 quick download for Accounting</span>
    <% end %>
    <%= link_to new_admin_export_path(export_type: "attendee_master_editable"), class: "export-card", data: { turbo_frame: "export_modal" } do %>
      <span class="export-card__icon"><i class="bi bi-pencil-square" aria-hidden="true"></i></span>
      <span class="export-card__label">Attendee Master (Editable & Re-uploadable)</span>
      <span class="export-card__desc">Custom columns 路 Excel for edit and re-import</span>
    <% end %>
    <%= link_to new_admin_export_path(export_type: "attendee_complete"), class: "export-card", data: { turbo_frame: "export_modal" } do %>
      <span class="export-card__icon"><i class="bi bi-file-earmark-spreadsheet" aria-hidden="true"></i></span>
      <span class="export-card__label">Complete Attendee Export</span>
      <span class="export-card__desc">Quotation, Invoice, or Receipt template 路 multi-class</span>
    <% end %>
    <%= link_to new_admin_export_path(export_type: "class_attendees"), class: "export-card", data: { turbo_frame: "export_modal" } do %>
      <span class="export-card__icon"><i class="bi bi-person-lines-fill" aria-hidden="true"></i></span>
      <span class="export-card__label">Class Attendees (Excel)</span>
      <span class="export-card__desc">Attendee list by class</span>
    <% end %>
    <%= link_to new_admin_export_path(export_type: "customer_for_accounting"), class: "export-card", data: { turbo_frame: "export_modal" } do %>
      <span class="export-card__icon"><i class="bi bi-bank" aria-hidden="true"></i></span>
      <span class="export-card__label">Customer for Accounting</span>
      <span class="export-card__desc">Company, tax ID, address, totals</span>
    <% end %>
  </div>
</div>

<%# Export history %>
<div class="export-section">
  <h3 class="export-section__title"><i class="bi bi-clock-history me-2" aria-hidden="true"></i>Export History</h3>
  <% stuck_running = @export_jobs.any? { |j| j.running? && j.started_at && j.started_at < 2.minutes.ago } %>
  <% if stuck_running %>
    <p class="export-list__hint mb-3"><i class="bi bi-arrow-clockwise me-1" aria-hidden="true"></i> Some exports are still processing. <strong>Refresh the page</strong> to update status.</p>
  <% end %>

  <ul id="export_list" class="export-list" aria-label="Export jobs">
    <% @export_jobs.each do |export_job| %>
      <%= render "admin/exports/export_row", export_job: export_job %>
    <% end %>
  </ul>

  <% if @export_jobs.empty? %>
    <p class="export-list__empty">No exports yet. Choose an export type above to generate a report.</p>
  <% end %>
</div>

<%= turbo_frame_tag "export_modal" %>
